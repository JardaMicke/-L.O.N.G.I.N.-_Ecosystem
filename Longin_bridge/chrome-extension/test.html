<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test WebRTC Bridge API</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    h1 {
      color: #2c3e50;
      border-bottom: 2px solid #3498db;
      padding-bottom: 10px;
    }
    .card {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin-bottom: 20px;
    }
    .status {
      display: inline-block;
      padding: 5px 10px;
      border-radius: 4px;
      font-weight: bold;
    }
    .status.connected {
      background-color: #2ecc71;
      color: white;
    }
    .status.disconnected {
      background-color: #e74c3c;
      color: white;
    }
    button {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #2980b9;
    }
    button:disabled {
      background-color: #95a5a6;
      cursor: not-allowed;
    }
    textarea {
      width: 100%;
      height: 100px;
      margin-bottom: 10px;
      border-radius: 4px;
      border: 1px solid #ddd;
      padding: 8px;
      font-family: monospace;
    }
    .log {
      background-color: #f8f9fa;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      height: 200px;
      overflow-y: auto;
      font-family: monospace;
      margin-top: 20px;
    }
    .log-entry {
      margin-bottom: 5px;
      border-bottom: 1px solid #eee;
      padding-bottom: 5px;
    }
    .log-entry.sent {
      color: #2980b9;
    }
    .log-entry.received {
      color: #27ae60;
    }
    .log-entry.error {
      color: #c0392b;
    }
  </style>
</head>
<body>
  <h1>Test WebRTC Bridge API</h1>
  
  <div class="card">
    <h2>Stav připojení</h2>
    <p>WebRTC Bridge: <span id="connection-status" class="status disconnected">Nepřipojeno</span></p>
    <p>Připojený klient: <span id="connected-client">-</span></p>
    <button id="connect-btn">Připojit</button>
    <button id="disconnect-btn" disabled>Odpojit</button>
  </div>
  
  <div class="card">
    <h2>Odeslat zprávu</h2>
    <textarea id="message-input" placeholder="Zadejte zprávu k odeslání..."></textarea>
    <button id="send-btn" disabled>Odeslat</button>
  </div>
  
  <div class="card">
    <h2>Log komunikace</h2>
    <div id="message-log" class="log"></div>
  </div>

  <script>
    // Tato funkce bude volána, když bude WebRTC Bridge API dostupné
    function onWebRTCBridgeReady() {
      console.log('WebRTC Bridge API je připraveno');
      
      const connectionStatus = document.getElementById('connection-status');
      const connectedClient = document.getElementById('connected-client');
      const connectBtn = document.getElementById('connect-btn');
      const disconnectBtn = document.getElementById('disconnect-btn');
      const messageInput = document.getElementById('message-input');
      const sendBtn = document.getElementById('send-btn');
      const messageLog = document.getElementById('message-log');
      
      // Aktualizace UI podle stavu připojení
      function updateConnectionUI(isConnected, clientName = '') {
        if (isConnected) {
          connectionStatus.textContent = 'Připojeno';
          connectionStatus.className = 'status connected';
          connectedClient.textContent = clientName || 'Neznámý klient';
          connectBtn.disabled = true;
          disconnectBtn.disabled = false;
          sendBtn.disabled = false;
        } else {
          connectionStatus.textContent = 'Nepřipojeno';
          connectionStatus.className = 'status disconnected';
          connectedClient.textContent = '-';
          connectBtn.disabled = false;
          disconnectBtn.disabled = true;
          sendBtn.disabled = true;
        }
      }
      
      // Přidání zprávy do logu
      function addLogEntry(message, type = 'info') {
        const entry = document.createElement('div');
        entry.className = `log-entry ${type}`;
        entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        messageLog.appendChild(entry);
        messageLog.scrollTop = messageLog.scrollHeight;
      }
      
      // Kontrola stavu připojení
      if (window.WebRTCBridge.isConnected()) {
        updateConnectionUI(true, window.WebRTCBridge.getConnectedClientName());
      }
      
      // Naslouchání na události připojení
      window.WebRTCBridge.onConnectionStateChange((state, clientName) => {
        console.log('Změna stavu připojení:', state, clientName);
        updateConnectionUI(state === 'connected', clientName);
        
        if (state === 'connected') {
          addLogEntry(`Připojeno k klientovi: ${clientName}`, 'info');
        } else if (state === 'disconnected') {
          addLogEntry('Odpojeno od klienta', 'info');
        }
      });
      
      // Naslouchání na příchozí zprávy
      window.WebRTCBridge.onMessage((message) => {
        console.log('Přijata zpráva:', message);
        addLogEntry(`Přijato: ${message}`, 'received');
      });
      
      // Obsluha tlačítka připojení
      connectBtn.addEventListener('click', () => {
        addLogEntry('Připojování k lokální aplikaci...', 'info');
        
        window.WebRTCBridge.connect()
          .then(() => {
            console.log('Úspěšně připojeno');
            // UI se aktualizuje přes event listener
          })
          .catch(error => {
            console.error('Chyba při připojování:', error);
            addLogEntry(`Chyba připojení: ${error.message}`, 'error');
          });
      });
      
      // Obsluha tlačítka odpojení
      disconnectBtn.addEventListener('click', () => {
        window.WebRTCBridge.disconnect();
        addLogEntry('Odpojeno od lokální aplikace', 'info');
        // UI se aktualizuje přes event listener
      });
      
      // Obsluha tlačítka odeslání zprávy
      sendBtn.addEventListener('click', () => {
        const message = messageInput.value.trim();
        if (message) {
          window.WebRTCBridge.sendMessage(message)
            .then(() => {
              addLogEntry(`Odesláno: ${message}`, 'sent');
              messageInput.value = '';
            })
            .catch(error => {
              console.error('Chyba při odesílání zprávy:', error);
              addLogEntry(`Chyba odeslání: ${error.message}`, 'error');
            });
        }
      });
    }
    
    // Kontrola, zda je WebRTC Bridge API již dostupné
    if (window.WebRTCBridge) {
      onWebRTCBridgeReady();
    } else {
      // Pokud není, nastavíme event listener
      window.addEventListener('WebRTCBridgeReady', onWebRTCBridgeReady);
    }
  </script>
</body>
</html>